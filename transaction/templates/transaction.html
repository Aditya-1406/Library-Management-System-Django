{% extends 'base.html' %}

{% block title %}
Your Transactions
{% endblock %}

{% block content %}

<h3 class="mt-4 mx-3">Your Transactions</h3>
<hr>

<div class="container mt-4 d-flex justify-content-end">
    <form method="post" class="d-flex mb-4">
        {%csrf_token%}
        <input type="text" class="form-control mb-3" name="search" placeholder="Search...">
        <button type="submit" class="btn btn-primary mb-3 mx-2">Search</button>
    </form>
</div>

<div class="container mt-4">
    {%if transactions%}
    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Book Name</th>
                <th scope="col">Borrowed At</th>
                <th scope="col">Due Date</th>
                <th scope="col">Returned At</th>
                <th scope="col">Fine</th>
                <th scope="col">Paid</th>
                <th scope="col">Pay</th>
            </tr>
        </thead>
        <tbody>
            {%for trans in transactions%}
            <tr>
                <th scope="row">{{forloop.counter}}</th>
                <td>{{trans.book.title}}</td>
                <td>{{trans.borrowed_at}}</td>
                <td>{{trans.due_date}}</td>
                <td>{{trans.returned_at}}</td>
                <td>{{trans.fine_amount}}</td>
                <td>{{trans.fine_paid}}</td>
                {% if trans.fine_amount > 0 %}
                {% if not trans.fine_paid %}
                <td>
                    <a href="{% url 'pay' trans.id %}" class="btn btn-sm btn-primary mt-2">
                        Pay
                    </a>
                </td>
                {% else %}
                <td>Paid</td>
                {% endif %}
                {% else %}
                <td>-</td>
                {% endif %}

            </tr>
            {%endfor%}
        </tbody>
    </table>
    {%else%}
    <p class="text-center">No transactions available.</p>
    {%endif%}
</div>
<div class="d-flex justify-content-center mt-4">
    {% if transactions.has_previous %}
    <a href="?page={{ transactions.previous_page_number }}" class="btn btn-outline-primary mx-1">Previous</a>
    {% endif %}

    <span class="mx-2">Page {{ transactions.number }} of {{ transactions.paginator.num_pages }}</span>

    {% if books.has_next %}
    <a href="?page={{ transactions.next_page_number }}" class="btn btn-outline-primary mx-1">Next</a>
    {% endif %}
</div>
{%endblock%}